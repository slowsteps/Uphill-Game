package  {		import flash.display.MovieClip;	import flash.events.Event;	import flash.events.MouseEvent;	import flash.events.KeyboardEvent;	import flash.ui.GameInput;			/*GameLoader is in charge of loading and destroying other all game scenes and screens, including	Main (the game), the Shop and the Gameover screen	*/		public class GameLoader extends MovieClip {				public var mymain:Main;		public var myGamestate:Gamestate		public var myintro:Intro;		public var skipintro:Boolean=false;		public var gameoverScreen:GameoverScreen		public var endingScreen:EndingScreen		public var shop:Shop						private var dialogueLines:Array		private var curDialogueLine:int = 0		private var logoParticleEmitter:Emitter										public function GameLoader() {						myGamestate = new Gamestate()						if (skipintro) reset();			else createIntro();					createScreens()			createDialogue()			//myintro.moregamesbutton.setChildIndex(logoParticleEmitter,this.numChildren-1)				}				private function onStart(e:Event) {						if (myintro) {				this.logoParticleEmitter.Stop()				removeChild(myintro);			}			stage.removeEventListener(KeyboardEvent.KEY_DOWN,onStart)			reset();				}		private function onMoreGames(e:Event) {			trace("load url")		}		public function createIntro() {			myintro = new Intro();			addChild(myintro);			myintro.startbutton.addEventListener(MouseEvent.CLICK,onStart);			stage.addEventListener(KeyboardEvent.KEY_DOWN,onStart)			myintro.startbutton.visible = false			myintro.moregamesbutton.addEventListener(MouseEvent.CLICK,onMoreGames);			myintro.dialoguebutton.addEventListener(MouseEvent.CLICK,getNextDialogueText)																	}						public function reset() {			if (mymain!=null) {				this.removeChild(mymain);			}			mymain= new Main(this);						addChild(mymain);			this.setChildIndex(mymain,0)					}		private function createScreens() {			shop = new Shop(this) 			addChild(shop)			shop.visible = false						gameoverScreen = new GameoverScreen(this)			addChild(gameoverScreen)			gameoverScreen.x = (this.stage.width - gameoverScreen.width)/2			gameoverScreen.y = (this.stage.height - gameoverScreen.height)/2			gameoverScreen.visible = false						endingScreen = new EndingScreen()			addChild(endingScreen)			endingScreen.visible = false						logoParticleEmitter = new Emitter();			logoParticleEmitter.setup(myintro,myintro.logo,0,0,"ParticleFireSpark");			//logoParticleEmitter.setup(myintro,myintro.logo,0,0,"ParticleTest");			logoParticleEmitter.setGravity(0.01)			logoParticleEmitter.setBlendmode("add")			logoParticleEmitter.setVelocity(0,-0.2,3);			logoParticleEmitter.setalphaDecaySpeed(0.1)			logoParticleEmitter.setEmitterShape(Emitter.AREA)		}		private function createDialogue() {						dialogueLines = new Array()			curDialogueLine = 0						dialogueLines.push({speaker:"dino",text:"Rabbit."})			dialogueLines.push({speaker:"rabbit",text:"Hey man."})			dialogueLines.push({speaker:"dino",text:"I shall be crossing the portal today"})			dialogueLines.push({speaker:"rabbit",text:"That's awesome."})			dialogueLines.push({speaker:"dino",text:"Too bad you will never see what's behind"})			dialogueLines.push({speaker:"dino",text:"you are too slow!..."})			dialogueLines.push({speaker:"dino",text:"HAHAHAHA!",animation:"laugh"})			dialogueLines.push({speaker:"dino",text:"HAHAHAHA \n \n HAHAHA!!",animation:"laugh"})			myintro.dinoBalloon.visible = false			myintro.rabbitBalloon.visible = false			myintro.menudino.stop()  //stop laughing		}		private function getNextDialogueText(e:Event) {			myintro.dinoBalloon.visible = false			myintro.rabbitBalloon.visible = false			myintro.menudino.stop()						var curlineObj:Object = dialogueLines[curDialogueLine]			if (curlineObj.speaker == "dino") {				myintro.dinoBalloon.textfield.text = curlineObj.text					myintro.dinoBalloon.visible = true				if (curlineObj.animation == "laugh") myintro.menudino.gotoAndPlay(1)				else myintro.menudino.stop()			}			if (curlineObj.speaker == "rabbit") {				myintro.rabbitBalloon.textfield.text = curlineObj.text				myintro.rabbitBalloon.visible = true				myintro.menudino.stop()			}			if (curDialogueLine < dialogueLines.length - 1)  {				curDialogueLine++			}			else {				myintro.dialoguebutton.visible = false				myintro.startbutton.visible = true			}					}		public function showEnding() {			endingScreen.visible = true		}	}		}